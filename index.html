<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BondBoard - Game Ikatan Kimia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .game-container {
            display: flex;
            max-width: 1200px;
            width: 100%;
            padding: 20px;
            gap: 20px;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            height: fit-content;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .player-info {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .player-info.active {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
        }

        .dice-section {
            text-align: center;
            margin: 20px 0;
        }

        .dice-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .dice-button:hover {
            transform: translateY(-2px);
        }

        .dice-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .dice-result {
            font-size: 2em;
            margin: 10px 0;
            font-weight: bold;
            color: #4299e1;
        }

        .board-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .square {
            aspect-ratio: 1;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .square:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .square.special {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-color: #e17055;
        }

        .square.catalyst {
            background: linear-gradient(45deg, #a8e6cf, #88d8a3);
        }

        .square.inhibitor {
            background: linear-gradient(45deg, #ffb3ba, #ff8a95);
        }

        .square.bonus {
            background: linear-gradient(45deg, #ffd93d, #ffb400);
        }

        .square-number {
            font-weight: bold;
            font-size: 1.2em;
            color: #4a5568;
        }

        .square-type {
            font-size: 0.8em;
            color: #666;
            text-align: center;
        }

        .player-token {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.5s ease;
        }

        .token-player1 { background: #4299e1; }
        .token-player2 { background: #48bb78; }
        .token-player3 { background: #ed8936; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .question-section h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .options {
            list-style: none;
            margin: 20px 0;
        }

        .options li {
            margin: 10px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .options li:hover {
            background: #edf2f7;
            border-color: #4299e1;
        }

        .options li.selected {
            background: #ebf8ff;
            border-color: #4299e1;
        }

        .modal-buttons {
            text-align: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .setup-modal .modal-content {
            text-align: center;
        }

        .player-setup {
            margin: 20px 0;
        }

        .player-setup input {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            width: 200px;
            margin: 5px;
        }

        .player-count-selector {
            margin: 20px 0;
        }

        .player-count-selector button {
            padding: 10px 20px;
            margin: 5px;
            border: 2px solid #4299e1;
            background: white;
            color: #4299e1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .player-count-selector button.selected {
            background: #4299e1;
            color: white;
        }

        .game-over-modal {
            text-align: center;
        }

        .winner-announcement {
            font-size: 2em;
            color: #48bb78;
            margin: 20px 0;
            font-weight: bold;
        }

        .final-scores {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .explanation {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
        }

        .explanation h4 {
            color: #2f855a;
            margin-bottom: 10px;
        }

        .timer {
            font-size: 1.2em;
            color: #e53e3e;
            margin: 10px 0;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        .animate-bounce {
            animation: bounce 1s ease-in-out;
        }

        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .board {
                grid-template-columns: repeat(5, 1fr);
                gap: 5px;
            }

            .header h1 {
                font-size: 2em;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🧪 BondBoard</h1>
        <p>Game Edukasi Ikatan Kimia</p>
    </div>

    <div class="game-container">
        <div class="sidebar">
            <div id="playersInfo"></div>
            
            <div class="dice-section">
                <button id="diceButton" class="dice-button">🎲 Lempar Dadu</button>
                <div id="diceResult" class="dice-result">-</div>
                <div id="currentPlayer" style="font-weight: bold; color: #4299e1;">Giliran: -</div>
            </div>

            <div id="gameStatus" style="text-align: center; margin-top: 20px; padding: 10px; background: #f7fafc; border-radius: 8px;">
                <strong>Status:</strong> Menunggu mulai permainan
            </div>
        </div>

        <div class="board-container">
            <div id="gameBoard" class="board"></div>
            <div id="gameInfo" style="text-align: center; color: #666; margin-top: 20px;">
                Selamat datang di BondBoard! Klik "Mulai Permainan" untuk memulai.
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="setupModal" class="modal" style="display: block;">
        <div class="modal-content setup-modal">
            <h2>🧪 Selamat Datang di BondBoard!</h2>
            <p>Game Edukasi Ikatan Kimia</p>
            
            <div class="player-count-selector">
                <h3>Pilih Jumlah Pemain:</h3>
                <button onclick="setPlayerCount(2)" class="selected">2 Pemain</button>
                <button onclick="setPlayerCount(3)">3 Pemain</button>
            </div>

            <div class="player-setup">
                <h3>Masukkan Nama Pemain:</h3>
                <div id="playerInputs">
                    <input type="text" id="player1Name" placeholder="Nama Pemain 1" value="Pemain 1">
                    <input type="text" id="player2Name" placeholder="Nama Pemain 2" value="Pemain 2">
                </div>
            </div>

            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="startGame()">🚀 Mulai Permainan</button>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <div class="question-section">
                <div id="timer" class="timer" style="display: none;">Waktu: <span id="timeLeft">30</span> detik</div>
                <h3 id="questionText"></h3>
                <ul id="optionsList" class="options"></ul>
                <div id="explanation" class="explanation" style="display: none;"></div>
            </div>
            <div class="modal-buttons">
                <button id="submitAnswer" class="btn btn-primary">Jawab</button>
                <button id="nextQuestion" class="btn btn-secondary" style="display: none;" onclick="closeQuestionModal()">Lanjutkan</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content game-over-modal">
            <h2>🎉 Permainan Selesai!</h2>
            <div id="winnerAnnouncement" class="winner-announcement"></div>
            <div id="finalScores" class="final-scores"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="restartGame()">🔄 Main Lagi</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            gameBoard: [],
            isGameActive: false,
            questionsUsed: []
        };

        // Question Bank
        const questionBank = [
            {
                question: "Ikatan yang terjadi antara atom logam dan atom non-logam disebut...",
                options: ["Ikatan kovalen", "Ikatan ion", "Ikatan logam", "Ikatan hidrogen"],
                correct: 1,
                explanation: "Ikatan ion terbentuk karena transfer elektron dari logam ke non-logam, menghasilkan ion positif dan negatif yang saling tarik-menarik."
            },
            {
                question: "Molekul H₂O memiliki bentuk geometri...",
                options: ["Linear", "Trigonal planar", "Tetrahedral", "Angular/bengkok"],
                correct: 3,
                explanation: "Dengan 2 pasangan elektron ikatan dan 2 pasangan elektron bebas, H₂O berbentuk angular dengan sudut ikatan sekitar 104.5°."
            },
            {
                question: "Unsur yang paling mudah membentuk ikatan ion adalah...",
                options: ["C dan O", "Na dan Cl", "H dan H", "N dan O"],
                correct: 1,
                explanation: "Na (logam alkali) mudah melepas elektron, sedangkan Cl (halogen) mudah menerima elektron, sehingga mudah membentuk ikatan ion."
            },
            {
                question: "Ikatan kovalen polar terjadi antara atom yang memiliki...",
                options: ["Elektronegativitas sama", "Perbedaan elektronegativitas besar", "Perbedaan elektronegativitas kecil", "Tidak ada perbedaan elektronegativitas"],
                correct: 2,
                explanation: "Ikatan kovalen polar terjadi ketika ada perbedaan elektronegativitas yang tidak terlalu besar (0.4-1.7) antara dua atom."
            },
            {
                question: "Rumus struktur Lewis untuk molekul CH₄ menunjukkan...",
                options: ["4 ikatan tunggal", "2 ikatan rangkap", "1 ikatan rangkap tiga", "3 ikatan tunggal + 1 pasangan elektron bebas"],
                correct: 0,
                explanation: "CH₄ (metana) memiliki 4 ikatan kovalen tunggal antara karbon dan masing-masing atom hidrogen."
            },
            {
                question: "Senyawa yang memiliki ikatan ion adalah...",
                options: ["CO₂", "H₂O", "NaCl", "CH₄"],
                correct: 2,
                explanation: "NaCl terbentuk dari transfer elektron dari Na⁺ ke Cl⁻, membentuk ikatan ion yang kuat."
            },
            {
                question: "Gaya antarmolekul yang paling kuat adalah...",
                options: ["Gaya van der Waals", "Ikatan hidrogen", "Interaksi dipol-dipol", "Gaya dispersi London"],
                correct: 1,
                explanation: "Ikatan hidrogen adalah gaya antarmolekul terkuat, terjadi antara atom H yang terikat pada N, O, atau F dengan pasangan elektron bebas."
            },
            {
                question: "Jumlah pasangan elektron di sekitar atom pusat dalam molekul NH₃ adalah...",
                options: ["3", "4", "5", "6"],
                correct: 1,
                explanation: "NH₃ memiliki 3 pasangan elektron ikatan dan 1 pasangan elektron bebas, total 4 pasangan elektron di sekitar nitrogen."
            },
            {
                question: "Sifat logam seperti konduktivitas listrik disebabkan oleh...",
                options: ["Ikatan ion", "Ikatan kovalen", "Ikatan logam", "Gaya van der Waals"],
                correct: 2,
                explanation: "Ikatan logam menghasilkan 'lautan elektron' yang dapat bergerak bebas, menyebabkan logam dapat menghantarkan listrik dan panas."
            },
            {
                question: "Molekul yang bersifat polar adalah...",
                options: ["CO₂", "CH₄", "H₂O", "BF₃"],
                correct: 2,
                explanation: "H₂O adalah molekul polar karena bentuk angular dan perbedaan elektronegativitas antara O dan H, menyebabkan momen dipol netto."
            },
            {
                question: "Hibridisasi atom karbon dalam molekul CH₄ adalah...",
                options: ["sp", "sp²", "sp³", "sp³d"],
                correct: 2,
                explanation: "Karbon dalam CH₄ mengalami hibridisasi sp³, membentuk 4 orbital hibrida yang setara untuk berikatan dengan 4 atom hidrogen."
            },
            {
                question: "Ikatan rangkap dua (C=C) terdiri dari...",
                options: ["2 ikatan sigma", "2 ikatan pi", "1 ikatan sigma + 1 ikatan pi", "1 ikatan pi + 1 ikatan delta"],
                correct: 2,
                explanation: "Ikatan rangkap dua terdiri dari 1 ikatan sigma (tumpang tindih frontal) dan 1 ikatan pi (tumpang tindih lateral)."
            },
            {
                question: "Senyawa yang dapat membentuk ikatan hidrogen adalah...",
                options: ["CH₄", "CO₂", "NH₃", "CCl₄"],
                correct: 2,
                explanation: "NH₃ dapat membentuk ikatan hidrogen karena memiliki atom N yang elektronegatif dan pasangan elektron bebas."
            },
            {
                question: "Energi kisi adalah energi yang diperlukan untuk...",
                options: ["Membentuk ikatan kovalen", "Memecah kristal ion menjadi ion gas", "Membentuk ikatan logam", "Memecah molekul"],
                correct: 1,
                explanation: "Energi kisi adalah energi yang diperlukan untuk memisahkan 1 mol kristal ion menjadi ion-ion gas, atau energi yang dilepas saat pembentukan kristal."
            },
            {
                question: "Teori VSEPR digunakan untuk memprediksi...",
                options: ["Jenis ikatan", "Bentuk molekul", "Kekuatan ikatan", "Titik didih"],
                correct: 1,
                explanation: "Teori VSEPR (Valence Shell Electron Pair Repulsion) digunakan untuk memprediksi bentuk geometri molekul berdasarkan tolakan pasangan elektron."
            },
            {
                question: "Atom yang dapat membentuk ikatan dativ adalah atom yang memiliki...",
                options: ["Elektron bebas", "Pasangan elektron bebas", "Orbital kosong", "Muatan positif"],
                correct: 1,
                explanation: "Ikatan dativ terbentuk ketika satu atom menyumbangkan sepasang elektron untuk berikatan dengan atom lain yang memiliki orbital kosong."
            },
            {
                question: "Senyawa ionik umumnya memiliki sifat...",
                options: ["Titik leleh rendah", "Tidak larut dalam air", "Menghantarkan listrik dalam bentuk lelehan", "Mudah menguap"],
                correct: 2,
                explanation: "Senyawa ionik dapat menghantarkan listrik dalam bentuk lelehan atau larutan karena ion-ionnya dapat bergerak bebas."
            },
            {
                question: "Perbedaan utama antara ikatan sigma dan pi adalah...",
                options: ["Kekuatan ikatan", "Cara tumpang tindih orbital", "Jenis atom yang berikatan", "Jumlah elektron"],
                correct: 1,
                explanation: "Ikatan sigma terbentuk dari tumpang tindih frontal orbital, sedangkan ikatan pi dari tumpang tindih lateral orbital."
            },
            {
                question: "Molekul BF₃ memiliki bentuk...",
                options: ["Linear", "Trigonal planar", "Tetrahedral", "Trigonal piramida"],
                correct: 1,
                explanation: "BF₃ memiliki 3 pasangan elektron ikatan di sekitar B tanpa pasangan elektron bebas, sehingga berbentuk trigonal planar."
            },
            {
                question: "Resonansi dalam ikatan kimia terjadi ketika...",
                options: ["Ada lebih dari satu struktur Lewis yang mungkin", "Molekul bergetar", "Ikatan putus-sambung", "Elektron berpindah atom"],
                correct: 0,
                explanation: "Resonansi terjadi ketika suatu molekul dapat digambarkan dengan beberapa struktur Lewis yang berbeda, dan struktur sebenarnya adalah hibrida dari semua kemungkinan struktur."
            }
        ];

        // Special squares configuration
        const specialSquares = {
            5: { type: 'catalyst', effect: 'maju', value: 3, name: 'Katalis' },
            10: { type: 'bonus', effect: 'bonus_point', value: 2, name: 'Bonus' },
            15: { type: 'inhibitor', effect: 'mundur', value: 2, name: 'Inhibitor' },
            20: { type: 'catalyst', effect: 'maju', value: 2, name: 'Katalis' },
            25: { type: 'bonus', effect: 'double_point', value: 2, name: 'Poin Ganda' },
            12: { type: 'special', effect: 'skip_turn', value: 1, name: 'Skip Giliran' }
        };

        // Initialize game
        function initGame() {
            createBoard();
            updateDisplay();
        }

        function setPlayerCount(count) {
            // Update button selection
            document.querySelectorAll('.player-count-selector button').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // Update player inputs
            const playerInputs = document.getElementById('playerInputs');
            playerInputs.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `player${i}Name`;
                input.placeholder = `Nama Pemain ${i}`;
                input.value = `Pemain ${i}`;
                playerInputs.appendChild(input);
            }
        }

        function startGame() {
            const playerCount = document.querySelectorAll('.player-count-selector button.selected').length > 0 
                ? parseInt(document.querySelector('.player-count-selector button.selected').textContent.charAt(0))
                : 2;
            
            gameState.players = [];
            
            for (let i = 1; i <= playerCount; i++) {
                const name = document.getElementById(`player${i}Name`).value || `Pemain ${i}`;
                gameState.players.push({
                    name: name,
                    position: 0,
                    score: 0,
                    accuracy: 0,
                    questionsAnswered: 0,
                    correctAnswers: 0
                });
            }
            
            gameState.currentPlayerIndex = 0;
            gameState.isGameActive = true;
            gameState.questionsUsed = [];
            
            document.getElementById('setupModal').style.display = 'none';
            initGame();
            updateGameStatus('Permainan dimulai! ' + gameState.players[0].name + ', lempar dadu untuk mulai!');
        }

        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            for (let i = 1; i <= 30; i++) {
                const square = document.createElement('div');
                square.className = 'square';
                square.id = `square-${i}`;
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'square-number';
                numberDiv.textContent = i;
                square.appendChild(numberDiv);
                
                if (specialSquares[i]) {
                    square.classList.add(specialSquares[i].type);
                    const typeDiv = document.createElement('div');
                    typeDiv.className = 'square-type';
                    typeDiv.textContent = specialSquares[i].name;
                    square.appendChild(typeDiv);
                }
                
                board.appendChild(square);
            }
            
            updatePlayerPositions();
        }

        function updateDisplay() {
            updatePlayersInfo();
            updateCurrentPlayer();
            updatePlayerPositions();
        }

        function updatePlayersInfo() {
            const playersInfo = document.getElementById('playersInfo');
            playersInfo.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-info ${index === gameState.currentPlayerIndex ? 'active' : ''}`;
                
                const accuracy = player.questionsAnswered > 0 ? Math.round((player.correctAnswers / player.questionsAnswered) * 100) : 0;
                
                playerDiv.innerHTML = `
                    <div class="player-name" style="color: ${getPlayerColor(index)}">${player.name}</div>
                    <div class="player-stats">
                        <span>Posisi: ${player.position}/30</span>
                        <span>Skor: ${player.score}</span>
                    </div>
                    <div class="player-stats">
                        <span>Akurasi: ${accuracy}%</span>
                        <span>Soal: ${player.questionsAnswered}</span>
                    </div>
                `;
                
                playersInfo.appendChild(playerDiv);
            });
        }

        function updateCurrentPlayer() {
            const currentPlayerName = gameState.players[gameState.currentPlayerIndex].name;
            document.getElementById('currentPlayer').textContent = `Giliran: ${currentPlayerName}`;
        }

        function updatePlayerPositions() {
            // Clear all tokens first
            document.querySelectorAll('.player-token').forEach(token => token.remove());
            
            // Add tokens to current positions
            gameState.players.forEach((player, index) => {
                if (player.position > 0 && player.position <= 30) {
                    const square = document.getElementById(`square-${player.position}`);
                    const token = document.createElement('div');
                    token.className = `player-token token-player${index + 1}`;
                    token.textContent = (index + 1).toString();
                    square.appendChild(token);
                }
            });
        }

        function getPlayerColor(index) {
            const colors = ['#4299e1', '#48bb78', '#ed8936'];
            return colors[index] || '#666';
        }

        function rollDice() {
            if (!gameState.isGameActive) return;
            
            const diceButton = document.getElementById('diceButton');
            diceButton.disabled = true;
            
            // Animate dice roll
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                const tempResult = Math.floor(Math.random() * 6) + 1;
                document.getElementById('diceResult').textContent = tempResult;
                rollCount++;
                
                if (rollCount >= 10) {
                    clearInterval(rollInterval);
                    const finalResult = Math.floor(Math.random() * 6) + 1;
                    document.getElementById('diceResult').textContent = finalResult;
                    
                    setTimeout(() => {
                        movePlayer(finalResult);
                    }, 500);
                }
            }, 100);
        }

        function movePlayer(steps) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const oldPosition = currentPlayer.position;
            let newPosition = oldPosition + steps;
            
            // Check if player reaches or passes finish line
            if (newPosition >= 30) {
                newPosition = 30;
                currentPlayer.position = newPosition;
                updatePlayerPositions();
                
                // Animate movement
                setTimeout(() => {
                    if (newPosition === 30) {
                        checkGameEnd();
                    } else {
                        showQuestion();
                    }
                }, 1000);
            } else {
                currentPlayer.position = newPosition;
                updatePlayerPositions();
                
                // Animate movement
                setTimeout(() => {
                    checkSpecialSquare(newPosition);
                }, 1000);
            }
            
            updateDisplay();
            updateGameStatus(`${currentPlayer.name} bergerak ${steps} langkah ke kotak ${newPosition}`);
        }

        function checkSpecialSquare(position) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            if (specialSquares[position]) {
                const special = specialSquares[position];
                let message = `${currentPlayer.name} mendarat di ${special.name}! `;
                
                switch (special.effect) {
                    case 'maju':
                        currentPlayer.position = Math.min(30, currentPlayer.position + special.value);
                        message += `Maju ${special.value} langkah!`;
                        updatePlayerPositions();
                        updateDisplay();
                        updateGameStatus(message);
                        
                        setTimeout(() => {
                            if (currentPlayer.position === 30) {
                                checkGameEnd();
                            } else {
                                showQuestion();
                            }
                        }, 2000);
                        return;
                        
                    case 'mundur':
                        currentPlayer.position = Math.max(0, currentPlayer.position - special.value);
                        message += `Mundur ${special.value} langkah!`;
                        updatePlayerPositions();
                        updateDisplay();
                        updateGameStatus(message);
                        
                        setTimeout(() => {
                            showQuestion();
                        }, 2000);
                        return;
                        
                    case 'skip_turn':
                        message += `Lawan kehilangan giliran berikutnya!`;
                        // This will be handled in next turn logic
                        break;
                        
                    case 'bonus_point':
                    case 'double_point':
                        message += `Soal bonus dengan poin ekstra!`;
                        break;
                }
                
                updateGameStatus(message);
                setTimeout(() => {
                    showQuestion(special);
                }, 2000);
            } else {
                showQuestion();
            }
        }

        function showQuestion(specialEffect = null) {
            if (gameState.players[gameState.currentPlayerIndex].position === 30) {
                checkGameEnd();
                return;
            }
            
            const availableQuestions = questionBank.filter(q => !gameState.questionsUsed.includes(q));
            if (availableQuestions.length === 0) {
                gameState.questionsUsed = []; // Reset if all questions used
            }
            
            const randomQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            gameState.questionsUsed.push(randomQuestion);
            
            document.getElementById('questionText').textContent = randomQuestion.question;
            
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            
            randomQuestion.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                li.onclick = () => selectOption(index);
                optionsList.appendChild(li);
            });
            
            // Store current question data
            gameState.currentQuestion = {
                question: randomQuestion,
                specialEffect: specialEffect,
                selectedAnswer: null
            };
            
            document.getElementById('explanation').style.display = 'none';
            document.getElementById('submitAnswer').style.display = 'inline-block';
            document.getElementById('nextQuestion').style.display = 'none';
            document.getElementById('questionModal').style.display = 'block';
            
            // Start timer (optional)
            startQuestionTimer();
        }

        function selectOption(index) {
            document.querySelectorAll('#optionsList li').forEach(li => li.classList.remove('selected'));
            document.querySelectorAll('#optionsList li')[index].classList.add('selected');
            gameState.currentQuestion.selectedAnswer = index;
        }

        function startQuestionTimer() {
            let timeLeft = 30;
            document.getElementById('timeLeft').textContent = timeLeft;
            document.getElementById('timer').style.display = 'block';
            
            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitAnswer(true); // Auto-submit when time's up
                }
            }, 1000);
            
            // Store timer reference to clear it if answer is submitted early
            gameState.currentTimer = timer;
        }

        function submitAnswer(timeUp = false) {
            if (gameState.currentTimer) {
                clearInterval(gameState.currentTimer);
            }
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const question = gameState.currentQuestion.question;
            const selectedAnswer = gameState.currentQuestion.selectedAnswer;
            const specialEffect = gameState.currentQuestion.specialEffect;
            
            if (selectedAnswer === null && !timeUp) {
                alert('Pilih jawaban terlebih dahulu!');
                return;
            }
            
            const isCorrect = selectedAnswer === question.correct;
            currentPlayer.questionsAnswered++;
            
            if (isCorrect) {
                currentPlayer.correctAnswers++;
                let points = 1;
                
                // Apply special effects
                if (specialEffect) {
                    switch (specialEffect.effect) {
                        case 'bonus_point':
                            points += specialEffect.value;
                            break;
                        case 'double_point':
                            points *= specialEffect.value;
                            break;
                    }
                }
                
                currentPlayer.score += points;
                
                updateGameStatus(`${currentPlayer.name} menjawab benar! +${points} poin`);
                
                // Add bounce animation to player info
                document.querySelector('.player-info.active').classList.add('animate-bounce');
                setTimeout(() => {
                    document.querySelector('.player-info.active').classList.remove('animate-bounce');
                }, 1000);
            } else {
                updateGameStatus(`${currentPlayer.name} menjawab salah. Jawaban yang benar: ${String.fromCharCode(65 + question.correct)}`);
            }
            
            // Show explanation
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ Benar!' : '❌ Salah!'}</h4>
                <p><strong>Jawaban yang benar:</strong> ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</p>
                <p><strong>Penjelasan:</strong> ${question.explanation}</p>
            `;
            explanationDiv.style.display = 'block';
            
            document.getElementById('submitAnswer').style.display = 'none';
            document.getElementById('nextQuestion').style.display = 'inline-block';
            document.getElementById('timer').style.display = 'none';
            
            updateDisplay();
        }

        function closeQuestionModal() {
            document.getElementById('questionModal').style.display = 'none';
            nextTurn();
        }

        function nextTurn() {
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            document.getElementById('diceButton').disabled = false;
            updateDisplay();
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            updateGameStatus(`Giliran ${currentPlayer.name}! Klik lempar dadu untuk melanjutkan.`);
        }

        function checkGameEnd() {
            const finishedPlayers = gameState.players.filter(p => p.position >= 30);
            
            if (finishedPlayers.length > 0) {
                gameState.isGameActive = false;
                
                // Sort players by position (descending) then by score (descending)
                const sortedPlayers = [...gameState.players].sort((a, b) => {
                    if (a.position !== b.position) {
                        return b.position - a.position;
                    }
                    return b.score - a.score;
                });
                
                const winner = sortedPlayers[0];
                
                document.getElementById('winnerAnnouncement').textContent = `🏆 ${winner.name} Menang!`;
                
                let scoresHTML = '<h3>📊 Skor Akhir:</h3>';
                sortedPlayers.forEach((player, index) => {
                    const accuracy = player.questionsAnswered > 0 ? Math.round((player.correctAnswers / player.questionsAnswered) * 100) : 0;
                    const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}.`;
                    
                    scoresHTML += `
                        <div style="margin: 10px 0; padding: 10px; background: ${index === 0 ? '#f0fff4' : '#f7fafc'}; border-radius: 8px; border-left: 4px solid ${getPlayerColor(gameState.players.indexOf(player))};">
                            <strong>${medal} ${player.name}</strong><br>
                            Posisi: ${player.position}/30 | Skor: ${player.score} poin<br>
                            Akurasi: ${accuracy}% (${player.correctAnswers}/${player.questionsAnswered})
                        </div>
                    `;
                });
                
                document.getElementById('finalScores').innerHTML = scoresHTML;
                document.getElementById('gameOverModal').style.display = 'block';
                
                updateGameStatus(`🎉 Permainan selesai! ${winner.name} adalah pemenangnya!`);
            }
        }

        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('setupModal').style.display = 'block';
            
            // Reset game state
            gameState = {
                players: [],
                currentPlayerIndex: 0,
                gameBoard: [],
                isGameActive: false,
                questionsUsed: []
            };
            
            document.getElementById('diceResult').textContent = '-';
            updateGameStatus('Menunggu setup permainan baru...');
        }

        function updateGameStatus(message) {
            document.getElementById('gameStatus').innerHTML = `<strong>Status:</strong> ${message}`;
            document.getElementById('gameInfo').textContent = message;
        }

        // Event Listeners
        document.getElementById('diceButton').addEventListener('click', rollDice);
        document.getElementById('submitAnswer').addEventListener('click', () => submitAnswer(false));

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('questionModal').style.display === 'block') {
                switch(event.key) {
                    case '1':
                    case 'a':
                    case 'A':
                        selectOption(0);
                        break;
                    case '2':
                    case 'b':
                    case 'B':
                        selectOption(1);
                        break;
                    case '3':
                    case 'c':
                    case 'C':
                        selectOption(2);
                        break;
                    case '4':
                    case 'd':
                    case 'D':
                        selectOption(3);
                        break;
                    case 'Enter':
                        if (document.getElementById('submitAnswer').style.display !== 'none') {
                            submitAnswer(false);
                        } else if (document.getElementById('nextQuestion').style.display !== 'none') {
                            closeQuestionModal();
                        }
                        break;
                }
            } else if (gameState.isGameActive && event.key === ' ') {
                event.preventDefault();
                rollDice();
            }
        });

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateGameStatus('Selamat datang di BondBoard! Siapkan permainan Anda.');
        });

        // Prevent modal close on outside click for better UX
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    // Only allow closing setup modal by clicking outside
                    if (modal.id === 'setupModal') {
                        // Don't close - force setup completion
                    }
                }
            });
        });
    </script>
</body>
</html>